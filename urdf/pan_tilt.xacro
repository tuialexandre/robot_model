<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="pan_tilt">
    
    <xacro:include filename="$(find robot_model)/urdf/macros.xacro" />
    <xacro:include filename="$(find robot_model)/urdf/common_properties.xacro" />
    <xacro:include filename="$(find robot_model)/urdf/visible_camera.xacro" />


    <xacro:macro name="pan_tilt">   
        <link name="pan_tilt_base_link">
            <inertial>
                    <origin xyz="0 0 0" rpy="0 0 0"/>
                    <mass value="${joints_mass}" />
                    <xacro:box_inertia 
                    m="${base_mass}" 
                    x="0.10" 
                    y="0.10" 
                    z="0.01"/>
                </inertial>
                <collision>
                    <origin xyz="0 0 0" rpy="0 0 0"/>
                    <geometry>
                        <box size="0.10 0.10 0.01"/>
                    </geometry>
                </collision>
                <visual>
                    <origin rpy="0.0 0 0" xyz="0 0 0"/>
                    <geometry>
                        <box size="0.10 0.10 0.01"/>
                    </geometry>
                </visual>
        </link>

        <joint name="pan_tilt_joint" type="fixed">
            <parent link="chassis"/>
            <child link="pan_tilt_base_link"/>
            <origin xyz="0.0 0.0 0.8" rpy="0 0 0"/>
        </joint>
            
        <link name="pan_link">
                <inertial>
                    <origin xyz="0 0 0" rpy="0 0 0"/>
                    <mass value="${joints_mass}" />
                    <cylinder_inertia 
                    m="${joints_mass}" 
                    r="0.03"
                    h="0.035"/>
                </inertial>
                <collision>
                    <origin xyz="0 0 0" rpy="0 0 0"/>
                    <geometry>
                        <cylinder radius="0.03" length="0.035"/>
                    </geometry>
                </collision>
                <visual>
                    <origin rpy="0 0 0" xyz="0 0 0"/>
                    <geometry>
                        <cylinder radius="0.03" length="0.035"/>
                    </geometry>
                </visual>
        </link>
            
        <gazebo reference="pan_link">
            <kp>100000.0</kp>
            <kd>100000.0</kd>
            <mu1>10.0</mu1>
            <mu2>10.0</mu2>
            <material>Gazebo/Grey</material>
        </gazebo>

        <joint name="pan_joint" type="continuous">
            <parent link="pan_tilt_base_link"/>
            <child link="pan_link"/>
            <origin xyz="0.0 0.0 0.025" rpy="0 0 0"/>
            <limit effort="${joint_pan_max_effort}" velocity="${joint_pan_max_speed}"/>
            <axis xyz="0 0 1"/>
        </joint>
        
        <transmission name="tran1">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="pan_joint">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
            </joint>
            <actuator name="motor1">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
                <mechanicalReduction>1</mechanicalReduction>
            </actuator>
        </transmission>
        
            
        <link name="tilt_link">
            <inertial>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <mass value="${joints_mass}" />
                <cylinder_inertia 
                m="${joints_mass}" 
                r="0.025"
                h="0.035"/>
            </inertial>

            <collision>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <cylinder radius="0.025" length="0.035"/>
                </geometry>
            </collision>

            <visual>
                <origin rpy="0.0 0 0" xyz="0 0 0"/>
                <geometry>
                    <cylinder radius="0.025" length="0.035"/>
                </geometry>
            </visual>
        </link>
            
        <gazebo reference="tilt_link">
            <kp>100000.0</kp>
            <kd>100000.0</kd>
            <mu1>10.0</mu1>
            <mu2>10.0</mu2>
            <material>Gazebo/Grey</material>
        </gazebo>

        <joint name="tilt_joint" type="revolute">
            <parent link="pan_link"/>
            <child link="tilt_link"/>
            <origin xyz="0.0 0.0 0.03" rpy="0 0 0"/>
            <limit lower="-0.7" upper="0.7" effort="${joint_tilt_effort}" velocity="${joint_tilt_max_speed}"/>
            <axis xyz="0 1 0"/>
        </joint>
            
        <transmission name="tran2">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="tilt_joint">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
            </joint>
            <actuator name="motor2">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
                <mechanicalReduction>1</mechanicalReduction>
            </actuator>
        </transmission>        
                
        <link name="up_pan_tilt_base_link">
            <inertial>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <mass value="${up_base_mass}" />
                <box_inertia 
                m="${up_base_mass}" 
                x="0.1" 
                y="0.1" 
                z="0.005"/>
            </inertial>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <box size="0.1 0.1 0.005"/>
                </geometry>
            </collision>
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0"/>
                <geometry>
                    <box size="0.1 0.1 0.005"/>
                </geometry>
            </visual>
        </link>
            
        <gazebo reference="up_pan_tilt_base_link">
            <kp>100000.0</kp>
            <kd>100000.0</kd>
            <mu1>10.0</mu1>
            <mu2>10.0</mu2>
            <material>Gazebo/Grey</material>
        </gazebo>

        <joint name="up_pan_tilt_base_joint" type="fixed">
            <parent link="tilt_link"/>
            <child link="up_pan_tilt_base_link"/>
            <origin xyz="0.0 0.0 0.02" rpy="0 0 0"/>
        </joint>
    </xacro:macro>

</robot>
